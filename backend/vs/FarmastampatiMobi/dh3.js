var doc=null;var list=null;var tbox=null;var tbox_init_retry=0;var disable_enter=false;function msgbox(e){disable_enter=true;$("html, body").animate({scrollTop:0},400);$("#popupDialogMessage").html(e);resizePopups();$("#popupDialogClick").click()}function restore_enter(){disable_enter=false}function dosearch(e){try{var a=null;if(tbox_init_retry>2){if(console)console.log("failure initializing autocomplete textbox, redirecting to noscript.html")}if(!tbox&&!e){throw"Inserire il codice AIC";tbox_init_retry++;setTimeout("dosearch()",400);return}tbox_init_retry=0;if(e&&e.length>0){if(tbox)tbox.val(e);a=e}else{a=tbox.val().trim()}if(!a||a.length==0)throw"Inserire il codice AIC";if(a.charAt(0).toUpperCase()=="A")a=a.substr(1);var i="";for(var t=0;t<a.length;t++){if("0123456789".indexOf(a.charAt(t))>=0){i+=a.charAt(t)}else if(" .-\r\n	".indexOf(a.charAt(t))<0){throw"Il codice AIC inserito non &egrave; corretto.<br/>"+"Deve contenere fino a un massimo di 9 caratteri numerici e "+"pu&ograve; avere come carattere iniziale la lettera A"}}while(i.length<9){i="0"+i}$("#caricamento").css("display","block");$("#page0file").load(function(){$("#caricamento").css("display","none")});$.ajax({url:"archive",dataType:"json",data:'{ "aic": "'+i+'" }',method:"post",success:function(e){try{if(!e&&e.length<=0)throw"Codice AIC non valido o non trovato.";if(!e[0].foglioVisualizzabile)throw"Il foglio presente nella confezione &egrave; aggiornato";if(e[0].foglioNonFornitoDalProduttore)throw"Foglio non reso disponibile dal produttore";doc=null;list=e;for(var a=0;a<list.length;a++){if(list[a].isDefaultLanguage){doc=list[a];break}}if(!doc||doc==null)doc=list[0];reload();$.mobile.changePage("#page0",{allowSamePageTransition:true,transition:"slidedown"})}catch(i){msgbox(i)}$("#caricamento").css("display","none")},error:function(e){$("#caricamento").css("display","none");msgbox("Codice AIC non valido o non trovato")}});$("#autocomplete").html("");$("#search").on("pageshow",function(){if(autofocus&&tbox){tbox.focus()}})}catch(o){msgbox(o)}if(tbox){tbox.val("")}}function getpageurl(e,a){var i="-sDEVICE=pngalpha -dFirstPage="+a+" -dLastPage="+a+" -dMaxBitmap=500000000 -dAlignToPixels=0 -dGridFitTT=0 -dTextAlphaBits=4 -dGraphicsAlphaBits=4 -r120x120";var t="-sDEVICE=pngalpha -dFirstPage="+a+" -dLastPage="+a+" -dMaxBitmap=500000000 -dAlignToPixels=0 -dGridFitTT=0 -dTextAlphaBits=1 -dGraphicsAlphaBits=4 -r120x120";var o="-sDEVICE=pngalpha -dFirstPage="+a+" -dLastPage="+a+" -dMaxBitmap=500000000 -dAlignToPixels=0 -dGridFitTT=0 -dTextAlphaBits=1 -dGraphicsAlphaBits=1 -r120x120";var n=-1;var r=false;var l="png";var s=i;return"pages/"+e+"?page="+a+(n>0?"&timeout="+n:"")+(r?"&nocache=true":"")+"&gsext="+l+"&gsopts="+encodeURI(s)}function reload(){var e="";for(var a=1;a<=doc.pagesCount;a++){e+='<div class="pagebreak" style="box-shadow: 10px 10px 5px #888888; width: 100%;">';e+='<img style="width: 100%;" src="'+getpageurl(doc.filename,a)+'" id="page'+a+'file" />';e+='<span data-role="footer" class="ui-btn-text">'+"Pagina "+a+" di "+doc.pagesCount+"</span>";e+="</div>"}$("#foglietto").html(e);$("#lang-it-0").css("display","none");$("#lang-de-0").css("display","none");$("#lang-en-0").css("display","none");$("#lang-fr-0").css("display","none");for(var i=0;i<list.length;i++){var t=list[i].language.toLowerCase();try{$("#lang-"+t+"-0").css("display","block")}catch(o){}}}function chlang(e){var a;if(e==doc.language.toLowerCase())return;$("#caricamento").css("display","block");for(a=0;a<list.length;a++){if(list[a].language.toLowerCase()==e){doc=list[a];break}}reload();if($.mobile.activePage.attr("id")=="page0"){$("html, body").animate({scrollTop:0},500)}else{$.mobile.changePage("#page0",{allowSamePageTransition:true,transition:"slide",reverse:true})}}function resizePopups(){var e=50;var a=$(window).width();var i=$(window).height();a-=e;$("#popupDialog").width(a);var t=$("#popupDialog").width();var o=$("#popupDialog").height();var n=0;var r=0;$("#popupDialog").css("max-height",i+"px").css("left",n+"px").css("top",r+"px")}var pageView="";var enablePageView=true;function scrollDetection(){var e=$(window);var a=e.scrollTop();if(enablePageView&&$.mobile.activePage.attr("id")=="page0"){pageView="";var i="";$("img").each(function(){{if(pageView.length>0)return;var e=$(this).attr("id");if(e==null)return;if(e.indexOf("page")<0)return;if(e.indexOf("file")<0)return;var t=$(this).offset().top;var o=$(this).offset().top+$(this).height();if(t<=a&&o>a){i="#"+e}else if(t>a&&o>a){if(t-a>$(window).height()/2){pageView=i}else{pageView="#"+e}}}})}setTimeout(scrollDetection,1e3)}function printpdf(){$("#navigbar").hide();setTimeout(function(){window.print();$("#navigbar").show()},800)}var autofocus=false;function _onload(e,a){autofocus=a;$("#autocomplete").on("filterablebeforefilter",function(e,a){var i=$(this),t=$(a.input),o=t.val(),n="";tbox=$(a.input);i.html("");if(o&&o.length>2){i.html("<li><div class='ui-loader'><span class='ui-icon ui-icon-loading'></span></div></li>");i.listview("refresh");$.ajax({url:"autocom",dataType:"jsonp",crossDomain:true,data:{q:t.val()}}).then(function(e){$.each(e,function(e,a){n+="<li><a href=\"javascript:dosearch('"+a+"');\">"+a+"</a></li>"});i.html(n);i.listview("refresh");i.trigger("updatelayout")})}});$("#loading").height=$("#searchButton").height;$(document).ajaxStart(function(){$("#searchButton").hide();$("#loading").fadeIn()}).ajaxStop(function(){$("#loading").hide();$("#searchButton").fadeIn()});$(window).on("orientationchange",function(e){enablePageView=false;try{$("meta[name=viewport]").attr("content","initial-scale=1; maximum-scale=1.0; user-scalable=1;");if($.mobile.activePage.attr("id")=="search"){$("html, body").animate({scrollTop:0},400);resizePopups()}else{$("html, body").animate({scrollTop:$(pageView).offset().top},1e3)}}catch(a){if(console)console.log(a)}enablePageView=true});document.body.addEventListener("gesturestart",function(){$("meta[name=viewport]").attr("content","initial-scale=1; maximum-scale=3.0; user-scalable=1;")},false);$(document).keydown(function(e){var a=e.keyCode?e.keyCode:e.which;if(a=="13"){if(disable_enter)return;dosearch()}else if(a>="32"){}});setTimeout(scrollDetection,1e3);if(e.length>0){dosearch(e);return}if(window.location.href.indexOf("#page0")>=0){$("#searchclick").click()}}
