var doc=null;var list=null;var tbox=null;var tbox_init_retry=0;var disable_enter=false;function msgbox(e){disable_enter=true;$("html, body").animate({scrollTop:0},400);$("#popupDialogMessage").html(e);resizePopups();$("#popupDialogClick").click()}function restore_enter(){disable_enter=false}function dosearch(e){try{var a=null;if(tbox_init_retry>2){if(console)console.log("failure initializing autocomplete textbox, redirecting to noscript.html");'document.location.href = "noscript.html"'}if(!tbox&&!e){tbox_init_retry++;setTimeout("dosearch()",400);return}tbox_init_retry=0;if(e&&e.length>0){if(tbox)tbox.val(e);a=e}else{a=tbox.val().trim()}if(!a||a.length==0)throw"Inserire il codice AIC";if(a.charAt(0).toUpperCase()=="A")a=a.substr(1);var t="";for(var i=0;i<a.length;i++){if("0123456789".indexOf(a.charAt(i))>=0){t+=a.charAt(i)}else if(" .-\r\n	".indexOf(a.charAt(i))<0){throw"Il codice AIC inserito non &egrave; corretto.<br/>"+"Deve contenere fino a un massimo di 9 caratteri numerici e "+"pu&ograve; avere come carattere iniziale la lettera A"}}while(t.length<9){t="0"+t}$("#caricamento").css("display","block");$("#page0file").load(function(){$("#caricamento").css("display","none")});$.ajax({url:"archive",dataType:"json",data:'{ "aic": "'+t+'" }',method:"post",success:function(e){try{if(!e&&e.length<=0)throw"Codice AIC non valido o non trovato.";if(!e[0].foglioVisualizzabile)throw"Il foglio presente nella confezione &egrave; aggiornato";if(e[0].foglioNonFornitoDalProduttore)throw"Foglio non reso disponibile dal produttore";doc=null;list=e;for(var a=0;a<list.length;a++){if(list[a].isDefaultLanguage){doc=list[a];break}}if(!doc||doc==null)doc=list[0];reload();$.mobile.changePage("#page0",{allowSamePageTransition:true,transition:"slidedown"})}catch(t){msgbox(t)}},error:function(e){msgbox("Codice AIC non valido o non trovato")}});$("#autocomplete").html("");$("#search").on("pageshow",function(){})}catch(o){msgbox(o)}if(tbox){tbox.val("")}}function getpageurl(e,a){var t="-sDEVICE=pngalpha -dFirstPage="+a+" -dLastPage="+a+" -dMaxBitmap=500000000 -dAlignToPixels=0 -dGridFitTT=0 -dTextAlphaBits=4 -dGraphicsAlphaBits=4 -r120x120";var i="-sDEVICE=pngalpha -dFirstPage="+a+" -dLastPage="+a+" -dMaxBitmap=500000000 -dAlignToPixels=0 -dGridFitTT=0 -dTextAlphaBits=1 -dGraphicsAlphaBits=4 -r120x120";var o="-sDEVICE=pngalpha -dFirstPage="+a+" -dLastPage="+a+" -dMaxBitmap=500000000 -dAlignToPixels=0 -dGridFitTT=0 -dTextAlphaBits=1 -dGraphicsAlphaBits=1 -r120x120";var n=-1;var r=false;var l="png";var s=t;return"pages/"+e+"?page="+a+(n>0?"&timeout="+n:"")+(r?"&nocache=true":"")+"&gsext="+l+"&gsopts="+encodeURI(s)}function reload(){var e=0;$("img").each(function(){var a=$(this).attr("id");if(a==null)return;if(a.indexOf("page")<0)return;if(a.indexOf("file")<0)return;e++;if(e>doc.pagesCount){$(this).css("display","none");$("#page"+(e-1)+"footer").css("display","none")}else{$(this).attr("src",getpageurl(doc.filename,e));$(this).css("display","block");$("#page"+(e-1)+"footer").html("Pagina "+e+" di "+doc.pagesCount);$("#page"+(e-1)+"footer").css("display","block")}});for(var a=0;a<1;a++){$("#lang-it"+"-"+a).css("display","none");$("#lang-de"+"-"+a).css("display","none");$("#lang-en"+"-"+a).css("display","none");$("#lang-fr"+"-"+a).css("display","none");for(var t=0;t<list.length;t++){var i=list[t].language.toLowerCase();try{$("#lang-"+i+"-"+a).css("display","block")}catch(o){}}}}function chlang(e){var a;if(e==doc.language.toLowerCase())return;$("#caricamento").css("display","block");for(a=0;a<list.length;a++){if(list[a].language.toLowerCase()==e){doc=list[a];break}}reload();if($.mobile.activePage.attr("id")=="page0"){$("html, body").animate({scrollTop:0},500)}else{$.mobile.changePage("#page0",{allowSamePageTransition:true,transition:"slide",reverse:true})}}function resizePopups(){var e=50;var a=$(window).width();var t=$(window).height();a-=e;$("#popupDialog").width(a);var i=$("#popupDialog").width();var o=$("#popupDialog").height();var n=0;var r=0;$("#popupDialog").css("max-height",t+"px").css("left",n+"px").css("top",r+"px")}var pageView="";var enablePageView=true;function scrollDetection(){var e=$(window);var a=e.scrollTop();if(enablePageView&&$.mobile.activePage.attr("id")=="page0"){pageView="";var t="";$("img").each(function(){{if(pageView.length>0)return;var e=$(this).attr("id");if(e==null)return;if(e.indexOf("page")<0)return;if(e.indexOf("file")<0)return;var i=$(this).offset().top;var o=$(this).offset().top+$(this).height();if(i<=a&&o>a){t="#"+e}else if(i>a&&o>a){if(i-a>$(window).height()/2){pageView=t}else{pageView="#"+e}}}})}setTimeout(scrollDetection,1e3)}function _onload(e){$("#autocomplete").on("filterablebeforefilter",function(e,a){var t=$(this),i=$(a.input),o=i.val(),n="";tbox=$(a.input);t.html("");if(o&&o.length>2){t.html("<li><div class='ui-loader'><span class='ui-icon ui-icon-loading'></span></div></li>");t.listview("refresh");$.ajax({url:"autocom",dataType:"jsonp",crossDomain:true,data:{q:i.val()}}).then(function(e){$.each(e,function(e,a){n+="<li><a href=\"javascript:dosearch('"+a+"');\">"+a+"</a></li>"});t.html(n);t.listview("refresh");t.trigger("updatelayout")})}});$("#loading").height=$("#searchButton").height;$(document).ajaxStart(function(){$("#searchButton").hide();$("#loading").fadeIn()}).ajaxStop(function(){$("#loading").hide();$("#searchButton").fadeIn()});$(window).on("orientationchange",function(e){enablePageView=false;try{$("meta[name=viewport]").attr("content","initial-scale=1; maximum-scale=1.0; user-scalable=1;");if($.mobile.activePage.attr("id")=="search"){$("html, body").animate({scrollTop:0},400);setTimeout("resizePopups()",400)}else{$("html, body").animate({scrollTop:$(pageView).offset().top},1e3)}}catch(a){if(console)console.log(a)}enablePageView=true});document.body.addEventListener("gesturestart",function(){$("meta[name=viewport]").attr("content","initial-scale=1; maximum-scale=3.0; user-scalable=1;")},false);$(document).keydown(function(e){var a=e.keyCode?e.keyCode:e.which;if(a=="13"){if(disable_enter)return;dosearch()}});setTimeout(scrollDetection,1e3);if(e.length>0){dosearch(e);return}if(window.location.href.indexOf("#page0")>=0){$("#searchclick").click()}}
