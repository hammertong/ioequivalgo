var doc=null;var list=null;var tbox=null;function msgbox(e){$("#popupDialogMessage").html(e);$("#popupDialog").popup("open")}function dosearch(e){try{var a=null;if(e&&e.length>0){if(tbox)tbox.val(e);a=e}else if(!tbox){msgbox("Inserire il codice AIC");return}else{a=tbox.val().trim()}if(!a||a.length==0)throw"Inserire il codice AIC";if(a.charAt(0).toUpperCase()=="A")a=a.substr(1);var i="";for(var t=0;t<a.length;t++){if("0123456789".indexOf(a.charAt(t))>=0)i+=a.charAt(t);else if(" .-\r\n	".indexOf(a.charAt(t))<0)throw"Il codice AIC inserito non &egrave; corretto.<br/>"+"Deve contenere fino a un massimo di 9 caratteri numerici e "+"pu&ograve; avere come carattere iniziale la lettera A"}while(i.length<9){i="0"+i}$("#caricamento").css("display","block");$("#page0file").load(function(){$("#caricamento").css("display","none")});$.ajax({url:"archive",dataType:"json",data:'{ "aic": "'+i+'" }',method:"post",success:function(e){try{if(!e&&e.length<=0)throw"codice AIC "+i+" non valido";doc=null;list=e;for(var a=0;a<list.length;a++){if(list[a].isDefaultLanguage){doc=list[a];break}}if(!doc||doc==null)doc=list[0];if(tbox){tbox.val("")}reload();$.mobile.changePage("#page0",{allowSamePageTransition:true,transition:"slidedown"})}catch(t){msgbox(t)}},error:function(e){msgbox("Codice AIC non trovato")}});$("#autocomplete").html("");$("#search").on("pageshow",function(){if(tbox){tbox.focus()}})}catch(o){msgbox(o)}}function getpageurl(e,a){var i=-1;var t=false;var o="png";var n="-sDEVICE=pngalpha "+"-dFirstPage="+a+" "+"-dLastPage="+a+" "+"-dMaxBitmap=500000000 "+"-dAlignToPixels=0 "+"-dGridFitTT=0 "+"-dTextAlphaBits=4 "+"-dGraphicsAlphaBits=4 "+"-r120x120";return"pages/"+e+"?page="+a+(i>0?"&timeout="+i:"")+(t?"&nocache=true":"")+"&gsext="+o+"&gsopts="+encodeURI(n)}function reload(){var e=0;$("img").each(function(){var a=$(this).attr("id");if(a==null)return;if(a.indexOf("page")<0)return;if(a.indexOf("file")<0)return;e++;if(e>doc.pagesCount){$(this).css("display","none");$("#page"+(e-1)+"footer").css("display","none")}else{$(this).attr("src",getpageurl(doc.filename,e));$(this).css("display","block");$("#page"+(e-1)+"footer").html("Pagina "+e+" di "+doc.pagesCount);$("#page"+(e-1)+"footer").css("display","block")}});for(var a=0;a<1;a++){$("#lang-it"+"-"+a).css("display","none");$("#lang-de"+"-"+a).css("display","none");$("#lang-en"+"-"+a).css("display","none");$("#lang-fr"+"-"+a).css("display","none");for(var i=0;i<list.length;i++){var t=list[i].language.toLowerCase();try{$("#lang-"+t+"-"+a).css("display","block")}catch(o){}}}}function chlang(e){var a;$("#caricamento").css("display","block");for(a=0;a<list.length;a++){if(list[a].language.toLowerCase()==e){doc=list[a];break}}reload();if($.mobile.activePage.attr("id")=="page0"){$("html, body").animate({scrollTop:0},"slow")}else{$.mobile.changePage("#page0",{allowSamePageTransition:true,transition:"slide",reverse:true})}}function _onload(e){$("#autocomplete").on("filterablebeforefilter",function(e,a){var i=$(this),t=$(a.input),o=t.val(),n="";tbox=$(a.input);i.html("");if(o&&o.length>2){i.html("<li><div class='ui-loader'><span class='ui-icon ui-icon-loading'></span></div></li>");i.listview("refresh");$.ajax({url:"autocom",dataType:"jsonp",crossDomain:true,data:{q:t.val()}}).then(function(e){$.each(e,function(e,a){n+="<li><a href=\"javascript:dosearch('"+a+"');\">"+a+"</a></li>"});i.html(n);i.listview("refresh");i.trigger("updatelayout")})}});$("#loading").height=$("#searchButton").height;$(document).ajaxStart(function(){$("#searchButton").hide();$("#loading").fadeIn()}).ajaxStop(function(){$("#loading").hide();$("#searchButton").fadeIn()});$("#popupAic").css("maxWidth",$(window.width));$("#popupAic").css("maxHeight",$(window.height));$("#popupDialog").css("maxWidth",$(window.width));$("#popupDialog").css("maxHeight",$(window.height));$(document).keydown(function(e){var a=e.keyCode?e.keyCode:e.which;if(a=="13"){dosearch()}});if(e.length>0){dosearch(e);return}if(window.location.href.indexOf("#page0")>=0){$("#searchclick").click()}}
