var e=ENDPOINT+"/query";var a=1e3;var i=1e3;var r=30;var t="query.xml";var n="prezzo discrezionale";var o={dati:null,nascondiPrezzoND:false,nascondiRimborsoND:false,encoding:"base64",ricercaIniziale:"",query:null};function msgbox(e,a,i){if(i){setTimeout("msgbox ('"+e+"', '"+a+"')",i);return}var r=$.mobile.activePage.attr("id");if(r=="search"){r=""}try{$("#popupDialog"+r+"Title").html(a?a:"Avviso");$("#popupDialog"+r+"Message").html(e);$("#popupDialog"+r).popup("open",{allowSamePageTransition:true,transition:"pop"})}catch(t){alert(t)}}function s(e){try{if(!e||e.length==0)return n;if(e.indexOf("0.00")==0)return n;if(e.indexOf("99999")==0)return n;var a=e.indexOf(".")<0?",":".";var i=e.split(a);if(i&&i.length>0){e=i[0];e+=a;e+=i[1].length>2?i[1].substr(0,2):i[1]}return"&euro; "+e}catch(r){return n}}function l(e,a){var i="";if(!a)a="'";for(var r=0;e!=null&&r<e.length;r++){var t=e.charAt(r);if(t==a)i+="\\";i+=t}return i}function c(e){var a=e.replace(/gtt /i,"gocce ").replace(/bust /i,"bustine ").replace(/polv /i,"polvere ").replace(/cpr /i,"compresse ").replace(/cps /i,"capsule ").replace(/grat /i,"granulato ").replace(/ riv/i," rivestite").replace(/ mast/i," masticabili").replace(/ eff/i," effervescenti").replace(/\*/g,"<br/>");var i=a.indexOf("(");var r=a.indexOf(")");if(i>0&&r>0&&i<r){a=a.substr(0,i).trim()+a.substr(r+1).trim()}return a}function u(e){if(e==null)return"";return e.toUpperCase()}function f(e){var a=e.split(" ");var i=0;var r=0;for(i=0;i<a.length;i++){if(!isNaN(a[i]))r++;if(r==2)break}var t="";for(var n=0;n<i;n++){t+=a[n];t+=" "}return t}function d(e,a){var i=0;var r=e.replace(/\?/gi,function s(e){if(i>a.length||typeof a[i]=="undefined")return e;var r=a[i++];if(r.indexOf&&r.indexOf("text:")==0){r="'"+l(r.substring(5,r.length),"'")+"'"}return r});if(DEBUG)console.log("SQL > "+r);switch(o.encoding){case"base64":return Base64.encode(r);case"xor":var t="";for(var n=0;n<a.length;n++){if(t.length>0)t+=";";t+=a[n]}return{data:r,params:t};default:return r}}function p(){var e="";var a=u(o.formaSelezionata).toUpperCase();$("#resultsHeader").html("");$("#resultsList").empty();e+='<ul data-role="listview" data-autodividers="false" data-inset="true">';e+='<li data-role="list-divider" style="color: #808080; min-height: 50px;">';e+='<span style="white-space:normal;">';e+="FARMACI EQUIVALENTI<br/>";e+=o.ricercaIniziale+"<br>";var i=B[4];i+=" ";for(var r=0;r<4;r++){if(!B||!B[r]||B[r].length==0)continue;if(i.length>0)i+=" ";i+=B[r]}e+=i;e+="</span>";e+="</li>";var t=0;var l=o.dati;var f="";for(var r=0;l!=null&&r<l.length;r++){var d=l[r];var p=c(d.descrizione);var h=s(d.prezzoAlPubblico);var v=s(d.prezzoRimborsoNazionale);if(h==n&&o.nascondiPrezzoND)continue;if(v==n&&o.nascondiRimborsoND)continue;var g="[["+d.descrizione+","+d.ditta+"]]";if(f.indexOf(g)>=0)continue;f+=g;if(B[z]!=null&&B[z]!="1"&&B[z]!=""&&d.descrizione.indexOf(B[z])<0){if(DEBUG)console.log("ignora posologia non selezionata ("+B[z]+"): "+d.descrizione);continue}var S=d.brand!="S"?"color: darkGreen;":"color: red;";e+='<li data-role="list-divider" style="background: white">';e+='<span class="x-scrolling" style=" '+S+'">';e+=p;e+='<br/><span style="font-size: smaller;">';e+=d.ditta;e+="</span>";if(d.classe=="CN")d.classe="C";if(h!=n){e+="<br/>Prezzo "+(d.classe=="C"?"massimo":"")+' <span color="'+(h==n?"darkRed":"darkBlue")+'">';e+=h;e+="</span>"}else{e+="<br/><i>Prezzo discrezionale</i>"}if(d.tipoRicetta&&d.classe=="C"&&(d.tipoRicetta!="C"&&d.tipoRicetta!="D"&&d.tipoRicetta!="h")){e+="<br/><b>Con obbligo di ricetta</b>"}if(v!=n){var E=parseFloat(d.prezzoAlPubblico);E-=parseFloat(d.prezzoRimborsoNazionale);E*=100;E=Math.round(E);var m=""+E;var I=m.substr(0,m.length-2);if(I.length==0)I="0";var O=m.substr(m.length-2,m.length);if(d.classe=="C"){e+="<br/><b><u>Costo a carico del cittadino</u></b>"}else if(d.classe=="A"){e+="<br/><b>Costo a carico del cittadino "+I+(O!="0"&&O!="00"?"."+O:"")+" &euro;</b>"}}if(d.inListaDiTrasparenza=="CN"){e+='&nbsp;<img src="images/inlista.png" style="border: 0px; width: 16px;" ';e+='alt="in lista di trasparenza"/>&nbsp;in lista di trasparenza'}e+="<br/><span>Classe "+d.classe+"</span>";e+="</span>";e+="</li>";t++}$("#resultsList").append(e);$("#resultsList ul").each(function(e){$(this).listview().listview("refresh")});return t}function h(a){$.ajax({url:e,dataType:"json",crossDomain:true,data:{sql:T(k!=null?"cercaDettagli":"cercaDettagliSenzaUPS",k!=null?[i,a,k]:[i,a]),encoding:o.encoding},method:"POST",success:function(e){o.dati=e;if(p()<=0){msgbox("Nessun farmaco equivalente autorizzato in<br/>classe A o C","Avviso",200);return}$.mobile.changePage("#results",{allowSamePageTransition:true,transition:"slide"})},error:function(e){msgbox("La ricerca della lista dei farmaci ha causato un errore","Avviso",200)}})}function v(e,a,i){var r=0;var t="0123456789BCDFGHJKLMNPQRSTUVWXYZ";for(var n=e.length-1;n>=0;n--){var o=t.indexOf(e.substr(n,1));r+=o*Math.pow(32,e.length-(n+1))}var s=""+r;if(a&&a>0){while(s.length<a){s="0"+s}}return i?i+s:s}function g(){$("#resultsList").html("");if(typeof cordova=="undefined"){msgbox("Funzione non disponibile in questa versione");return}cordova.plugins.barcodeScanner.scan(function(e){if(e.cancelled){return}if(e.format=="CODE_39"){var a=v(e.text,9);if(a.indexOf("A")>=0)a=a.substr(1);k=null;C(a)}else{msgbox("Il codice a barre non &egrave; valido<br/>provare con un altro codice a barre riportato sulla scatola")}},function(e){msgbox("Scansione fallita<br/>codice di errore:"+e)})}function OnClickAutocomplete(e,a,i){$(i).html("");$(i).listview("refresh");$(i).listview().listview("refresh");if(i=="#autocomplete1"){$("#autocomplete2div").hide()}else if(i=="#autocomplete2"){$("#autocomplete1div").hide()}S=i;$("#search").find("input").val(e);var r=E();o.ricercaIniziale=r;if(B){for(var t=0;t<B.length;t++){B[t]=""}}switch(a){case"C":D("tabellaOrdinataDosaggiPerPA",r);break;case"D":D("tabellaOrdinataDosaggiPerNF",r);break;default:if(DEBUG)console.log("ERROR: OnClickAutocomplete invoked with invalid type: "+a);break}}var S=null;function E(){var e="";var a=0;$("#search .ui-input-search").find("input").each(function(a){e=$(this).val()});return e}function m(e,a){var i="";$("#search .ui-input-search "+a).find("input").each(function(a){$(this).textinput(e?"enable":"disable")});return i}function I(){$("#search .ui-input-search").find("input").each(function(e){$(this).val("")})}function O(e){var a=0;var i="";var r=e.split(" ");var t=false;for(var n=0;n<r.length;n++){if(a==3&&i.length>0)break;var o=r[n].replace(/\,/g,".").toUpperCase();if(n==0&&!isNaN(o))continue;if(r[n]=="+"&&t){i+=" +";t=false;a=0}else if(!isNaN(o)){i+=" ";i+=r[n];t=false;a=0}else if(o.indexOf("CPR")>=0||o.indexOf("CPS")>=0||o.indexOf("BUST")>=0||o.indexOf("GRAT")>=0||o.indexOf("BOMB")>=0){i="";t=true;a=0}else{if(i.length>0){i+=" ";i+=r[n]}t=true}a++}if(i.trim().length==0)return e;var s=i.trim();return s.replace(/litro litri/i,"litri").replace(/litri litri/i,"litri").replace(/litri \(litri/i,"litri").replace(/litri con/i,"litri").replace(/ con/i,"")}function R(a){var r=null;if(DEBUG)console.log("recupero dettagli di farmaci senza equiv.: "+a);if(a.indexOf(",")>0){var t=a.split(",");var n="";for(var s=0;s<t.length;s++){if(!t[s])continue;if(t[s].length==0)continue;if(n.length>0)n+=", ";n+="'"+t[s]+"'"}r=T("recuperaDettaglioAIC",[i,n])}else{r=T("recuperaDettaglioAIC",[i,"text:"+a])}$.ajax({url:e,dataType:"json",crossDomain:true,data:{sql:r,encoding:o.encoding},method:"POST",success:function(e){o.dati=e;if(p()<=0){msgbox("Nessun farmaco equivalente autorizzato in<br/>classe A o C","Avviso",200);return}$.mobile.changePage("#results",{allowSamePageTransition:true,transition:"slide"})},error:function(e){msgbox("La ricerca della lista dei farmaci ha causato un errore","Avviso",200)}})}function C(a){var i="";if(a.indexOf(",")>0){var r=a.split(",");var t="";for(var n=0;n<r.length;n++){if(!r[n])continue;if(r[n].length==0)continue;if(t.length>0)t+=", ";t+="'"+r[n]+"'"}i=T("cercaGruppoPerAIC_in",[t])}else{i=T("cercaGruppoPerAIC",["text:"+a])}$.ajax({url:e,dataType:"json",crossDomain:true,data:{sql:i,encoding:o.encoding},method:"POST",success:function(e){if(!e||e.length<=0){R(a);return}var i="";for(var r=0;r<e.length;r++){o.formaSelezionata=e[r].dosaggio;dosaggioSelezionato="";if((!e[r].codeA||e[r].codeA.length==0)&&(!e[r].codeC||e[r].codeC.length==0))continue;switch(e[r].classe){case"A":case"H":if(i.length>0)i+=" OR ";i+="APP_CA.FDI_1010 = '"+e[r].codeA+"'";break;case"C":case"CN":if(i.length>0)i+=" OR ";i+="APP_CA.FDI_1094 = '"+e[r].codeC+"'";break;default:if(DEBUG)console.log("warning: trovata classe non valida: "+e[r].classe)}if(G!=2)break}if(i.length==0){R(a);return}h(i)},error:function(e){msgbox("La ricerca dei farmaci equivalenti ha causato un errore:<br/>"+e)}})}function b(e){switch(e.toUpperCase()){case"COMPRESSE DELITESCENTI":case"COMPRESSE DISPERSIBILI":case"COMPRESSE DIVISIBILI":case"COMPRESSE DIVISIBILI RM":case"COMPRESSE DIVISIBILI RP":case"COMPRESSE DIVISIBILI RILASCIO MODIFICATO":case"COMPRESSE DIVISIBILI RILASCIO PROLUNGATO":case"COMPRESSE EFFERVESCENTI SOLUB":case"COMPRESSE EFFERVESCENTI SOLUB.":case"COMPRESSE EFFERVESCENTI SOLUBILI":case"COMPRESSE GASTRORESISTENTI":case"COMPRESSE GASTRORESISTENTI RM":case"COMPRESSE GASTRORESISTENTI RP":case"COMPRESSE GASTRORESISTENTI RILASCIO MODIFICATO":case"COMPRESSE GASTRORESISTENTI RILASCIO PROLUNGATO":case"COMPRESSE MUCOADESIVE":case"COMPRESSE ORODISPERSIBILI":case"COMPRESSE ORODISPERS/SUBLING":case"COMPRESSE ORODISPERS./SUBLING.":case"COMPRESSE ORODISPERSIBILI/COMPRESSE SUBLINGUALI":case"COMPRESSE RC":case"COMPRESSE RILASCIO CONTROLLATO":case"COMPRESSE RIVESTITE":case"COMPRESSE RIVESTITE DIVISIBILI":case"COMPRESSE RIVESTITE GASTRORES":case"COMPRESSE RIVESTITE GASTRORESISTENTI":case"COMPRESSE RIVESTITE MASTICAB":case"COMPRESSE RIVESTITE MASTICABILI":case"COMPRESSE RIVESTITE RM":case"COMPRESSE RIVESTITE RP":case"COMPRESSE RIVESTITE RILASCIO MODIFICATO":case"COMPRESSE RIVESTITE RILASCIO PROLUNGATO":case"COMPRESSE RM":case"COMPRESSE RILASCIO MODIFICATO":case"COMPRESSE RP":case"COMPRESSE RILASCIO PROLUNGATO":case"COMPRESSE SOLUBILI":case"COMPRESSE SOLUB E MASTICABILI":case"COMPRESSE SOLUBILI E MASTICABILI":case"COMPRESSE SOLUZIONE CUTANEA":case"COMPRESSE PER SOLUZIONE CUTANEA":case"COMPRESSE SUBLINGUALI":return"COMPRESSE";case"COMPRESSE RIVESTITE MASTICAB":case"COMPRESSE RIVESTITE MASTICABILI":return"COMPRESSE MASTICABILI"}return e}function T(e,a){var i=null;if(DEBUG)console.log("searching named query: "+e+" ...");o.query.find("query").each(function(){var a=$(this).attr("name");if(a.toLowerCase().trim()==e.toLowerCase().trim()){return $(this).find("sql").each(function(){i={sql:$(this).text().trim(),encoding:$(this).attr("encoding")}})}});return d(i.sql,a)}var P=false;function A(){if("onhashchange"in window){window.location.hash="no-back-button";window.location.hash="Again-No-back-button";window.onhashchange=function(){if(P){P=false;goback();return}var e=window.location.hash;if(e=="#no-back-button"){return}else if(e=="#results"){setTimeout(function(){P=true},1e3)}else if(e=="#search"){}window.location.hash="no-back-button"}}else{console.log("warning: cannot detect back/forward pressed...")}$("#cerca3").on("click",function(){g()});$("#resultsMenu :input").change(function(){switch(this.name){case"choice-1":o.nascondiPrezzoND=this.checked;p();break;case"choice-2":o.nascondiRimborsoND=this.checked;p();break}});$("#searchclickProducts").on("click",function(){$("#cerca0").html("");$("#menuforma").hide();$("#menucerca").hide();$("#menucerca").slideToggle("slow",function(){});setTimeout(function(){$.mobile.changePage("#search",{reverse:true,allowSamePageTransition:true,transition:"slide"})},200)});$("#searchclick").on("click",function(){$("#menuforma").hide();$("#menucerca").hide();$("#menucerca").slideToggle("slow",function(){});I();$("#autocomplete1div").show();$("#autocomplete2div").show();$("#cerca0").html("");setTimeout(function(){$.mobile.changePage("#search",{reverse:true,allowSamePageTransition:true,transition:"slide"})},200)});if(typeof cordova=="undefined"){}$("#autocomplete1").on("filterablebeforefilter",function(i,r){var t=$(this),n=$(r.input),s=n.val(),l="";t.html("");if(typeof android_versionCode!="undefined"){var c=n.offset().top;c-=n.height();$("html, body").animate({scrollTop:c},400)}if(s&&s.length>2){t.html("<li><div class='ui-loader'><span class='ui-icon ui-icon-loading'></span></div></li>");t.listview("refresh");var u="";var f=s.split(" ");for(var d=0;d<f.length;d++){var p=f[d];if(p.length==0)continue;u+=u.length>0?"%"+p:p}var h=u;if(u.length<=2)return;var v=T("autocompletaPrincipioAttivo",[a,"text:"+u+"%"]);$.ajax({url:e,dataType:"jsonp",crossDomain:true,data:{sql:v,encoding:o.encoding}}).then(function(e){var a="|";$.each(e,function(e,i){var r=null;var t=i.split("|");if(t[0]=="A"||t[0]=="C"){r=t[1];if(a.indexOf("|"+r+"|")>=0)return;a+=r+"|";r='<span style="color: #007700; white-space:normal;">'+r+"</span>"}else if(t[0]=="B"||t[0]=="D"){r=t[1].replace(/\(/gi,'<i style="font-size: smaller;">').replace(/\)/gi,"</i>");if(a.indexOf("|"+r+"|")>=0)return;a+=r+"|";r='<span style="color: #000077; white-space:normal;">'+r+"</span>"}l+="<li><a href=\"javascript:OnClickAutocomplete('"+t[1]+"', '"+t[0]+"', '#autocomplete1')\">"+r+"</a></li>"});t.html(l);t.listview("refresh");t.trigger("updatelayout")})}});$("#autocomplete2").on("filterablebeforefilter",function(i,r){var t=$(this),n=$(r.input),s=n.val(),l="";t.html("");if(typeof android_versionCode!="undefined"){var c=n.offset().top;c-=n.height();$("html, body").animate({scrollTop:c},400)}if(s&&s.length>2){t.html("<li><div class='ui-loader'><span class='ui-icon ui-icon-loading'></span></div></li>");t.listview("refresh");var u="";var f=s.split(" ");for(var d=0;d<f.length;d++){var p=f[d];if(p.length==0)continue;u+=u.length>0?"%"+p:p}var h=u;if(u.length<=2)return;var v=T("autocompletaNomeFarmaco",[a,"text:"+h+"%"]);$.ajax({url:e,dataType:"jsonp",crossDomain:true,data:{sql:v,encoding:o.encoding}}).then(function(e){var a="|";$.each(e,function(e,i){var r=null;var t=i.split("|");if(t[0]=="A"||t[0]=="C"){r=t[1];if(a.indexOf("|"+r+"|")>=0)return;a+=r+"|";r='<span style="color: #007700; white-space:normal;">'+r+"</span>"}else if(t[0]=="B"||t[0]=="D"){r=t[1].replace(/\(/gi,'<i style="font-size: smaller;">').replace(/\)/gi,"</i>");if(a.indexOf("|"+r+"|")>=0)return;a+=r+"|";r='<span style="color: #000077; white-space:normal;">'+r+"</span>"}l+="<li><a href=\"javascript:OnClickAutocomplete('"+t[1]+"', '"+t[0]+"', '#autocomplete2')\">"+r+"</a></li>"});t.html(l);t.listview("refresh");t.trigger("updatelayout")})}else if(s&&s.length==0){I();$("#autocomplete1div").show();$("#autocomplete2div").show();$("#cerca0").html("")}});$.ajax({type:"GET",url:t,dataType:"xml",success:function(e){o.query=$(e)},error:function(){alert("Cannot load backend queries from XML.");return}});$("#search").on("pageshow",function(e){if(!$("#searchmain").is(":visible")){$("#searchmain").fadeIn(800)}$("#search div .ui-input-search").each(function(e){$(this).css("font-size","16px");$(this).css("height","40px");$(this).css("border","4px solid #c0c0c0")});$("#search .ui-input-search").find("input").each(function(e){$(this).css("font-size","16px");$(this).css("height","100%");$(this).css("color","darkBLue")});$("#search .ui-input-clear").on("click",function(e){for(var a=0;a<B.length;a++){B[a]=""}$("#cerca0").html("");$("#menuforma").hide();I();$("#autocomplete1div").show();$("#autocomplete2div").show();$("#menucerca").show()})});$(document).ajaxStart(function(){$("html, body").animate({scrollTop:0},400);$("#popupWait").popup("open",{allowSamePageTransition:true,transition:"pop"})}).ajaxStop(function(){$("html, body").animate({scrollTop:0},400);$("#popupWait").popup("close")});$(document).keydown(function(e){var a=false;var i=e.keyCode?e.keyCode:e.which;if(i=="8"){var r=e.srcElement||e.target;if(r.tagName.toUpperCase()==="INPUT"&&(r.type.toUpperCase()==="TEXT"||r.type.toUpperCase()==="PASSWORD"||r.type.toUpperCase()==="FILE"||r.type.toUpperCase()==="SEARCH"||r.type.toUpperCase()==="EMAIL"||r.type.toUpperCase()==="NUMBER"||r.type.toUpperCase()==="DATE")||r.tagName.toUpperCase()==="TEXTAREA"){a=r.readOnly||r.disabled}else{a=true}}else if(i=="9"){}else if(i=="13"){}if(a){e.preventDefault()}});$("#search").on("swiperight",function(){});$("#results").on("swiperight",function(){})}function w(){for(var e=0;e<U.length;e++){if(U[e][1]>0)U[e][1]--}var a=0;for(a=B.length-1;a>0;a--){if(B[a]!=""){break}}B[a]="";a--;if(a>0){setPage(a,B[a],true)}else{goback()}}function goback(){if($("#cerca0").html().length==0)return;for(var e=0;e<B.length;e++){B[e]=""}setTimeout(function(){$("#menuforma").hide();$("#menucerca").hide();$.mobile.changePage("#search",{reverse:true,allowSamePageTransition:true,transition:"slide"});$("#cerca0").html("");I();$("#autocomplete1div").show();$("#autocomplete2div").show();$("#menucerca").slideToggle("slow",function(){})},200)}function y(){}function M(){}var app={initialize:function(){this.bindEvents();if(typeof cordova=="undefined"){this.onDeviceReady()}},bindEvents:function(){document.addEventListener("deviceready",this.onDeviceReady,false)},onDeviceReady:function(){document.addEventListener("hidekeyboard",y,false);document.addEventListener("showkeyboard",M,false);app.receivedEvent("deviceready");var e=document.getElementById("home1");var a=e.querySelector(".listening");var i=e.querySelector(".received");a.setAttribute("style","display:none;");i.setAttribute("style","display:block;");A()},receivedEvent:function(e){if(console){if(DEBUG)console.log("Received Event: "+e)}}};function D(a,i){if(!a||a.length==0){if(DEBUG)console.log("ERRORE: query non specificata in cercaTabellaOrdinataDosaggi()");return}if(!i||i.length==0){if(DEBUG)console.log("ERRORE: chiave di ricerca non specificata in cercaTabellaOrdinataDosaggi()");return}if(a=="tabellaOrdinataDosaggiPerNF"){i+="%"}$.ajax({url:e,dataType:"json",crossDomain:true,data:{sql:T(a,["text:"+i]),encoding:o.encoding},method:"POST",success:function(e){if(!e||e.length<=0){msgbox("Nessun farmaco autorizzato in<br/>classe A o C","Avviso",200);return}var a=null;var i=null;var r=null;var t=0;var n=false;U=[""];for(var o=0;o<e.length;o++){if(a!=e[o].aic||i!=e[o].id_par){t++;var s=b(e[o].forma);var l=parseInt(e[o].ups);n=true;U[t]=[e[o].aic,0,s,x(e[o]),l,l]}else{if(r==e[o].id_seq&&n){U[t][4]+=parseInt(e[o].ups)}else{n=false;var c=x(e[o]);if(c.length>0){if(U[t][3].length>0){U[t][3]+=" + "}U[t][3]+=c}}}a=e[o].aic;i=e[o].id_par;r=e[o].id_seq}stage=1;setPage(1,null)},error:function(e){if(DEBUG)console.log("remote error: "+JSON.stringify(e));msgbox("Impossibile collegarsi al backend","Avviso",500)}})}function L(e){var a=e.split(".");var i=a[0];var r=a[1];var t=r.length-1;while(t>=0){if(r[t]!="0")break;t--}if(t<0){return i}else{return i+","+r.substr(0,t+1)}}function N(e){if(!isNaN(e)||e.length<r)return e;return e.substr(0,r)+" ..."}function x(e){var a="";try{if(a.length==0&&e.pa_qta!=null){var i=e.pa_qta.replace(/\,/g,".");if(parseFloat(i)>0){a+=L(i);a+=" ";a+=e.pa_um}}if(a.length==0&&e.pa_perc!=null){var r=e.pa_perc.replace(/\,/g,".");if(parseFloat(r)>0){a+=L(r);a+=" ";a+="%"}}if(a.length==0&&e.pas_qta!=null){var i=e.pas_qta.replace(/\,/g,".");if(parseFloat(i)>0){a+=L(i);a+=" ";a+=e.pas_um}}if(a.length==0&&e.pas_perc!=null){var r=e.pas_perc.replace(/\,/g,".");if(parseFloat(r)>0){a+=L(r);a+=" ";a+="%"}}}catch(t){if(DEBUG)console.log("error: "+t+" - getDose() -> from "+JSON.stringify(e))}if(a.charAt(a.length-1)==",")a=a.substr(0,a.length-1);return a}var z=4;var U=[""];var B=["","","","","","",""];var k=null;var G=2;function setPage(e,a,i){B[e]=a;if(e>=z){var r="";var t=null;for(var n=1;n<U.length;n++){if(a&&e>1&&a!=U[n][e]){U[n][1]++}if(e>1&&U[n][1]>0)continue;var o=U[n][0];t=U[n][5];switch(G){case 2:if(r.length>0){r+=","}r+=o;break;case 1:if(r.length==0){r=o}break;case 0:r=o;break}}k=t;C(r);return}else{var s="";var l=[""];var c=0;var u="|";for(var n=1;n<U.length;n++){if(a&&e>1&&a!=U[n][e]){U[n][1]++}if(e>1&&U[n][1]>0)continue;var f=U[n][e+1];if(u.indexOf("|"+f+"|")>=0)continue;u+=f;u+="|";s+='<tr><td align="left">';s+='<a href="javascript: setPage('+(e+1)+", '"+f+"')\" ";s+='class="ui-corner-all ui-shadow ui-overlay-shadow ui-btn" ';s+='style="background: #11389D; color: white; font-weight: bolder; border-radius: 16px !important;">';s+='<span class="ui-btn-inner" style="vertical-align: middle;">';s+='<span class="ui-btn-text" style="font-size: 14px;">'+N(f)+"</span>";s+="</span>";s+="</a>";s+="</td></tr>";l[c++]=f}if(c<2){setPage(e+1,l[0]);return}}var d='<span style="font-size: 12px;">';for(var n=2;n<=e+1;n++){if(n>2)d+=" &gt; ";d+=B[n]}d+="</span><br/>";switch(e){case 1:d+="selezionare la tipologia";break;case 2:d+="selezionare il dosaggio";break;case 3:d+="selezionare unit&agrave; posologiche";break}$("#cerca0").html(d);$("#menucerca").hide();$("#menuforma").hide();$("#menuforma").html(s);var p=0;var h=[""];$("#menuforma tr").each(function(){var e=$(this);h[p++]=e.text()});h=h.sort(function(e,a){try{var i=e.replace(/\,/g,".").split(" ")[0].toLowerCase();var r=a.replace(/\,/g,".").split(" ")[0].toLowerCase();if(!isNaN(i)&&!isNaN(i)){return parseFloat(i)<parseFloat(r)?1:-1}else{i=e;r=a;for(var t=0;t<i.length&&t<r.length;t++){if(i.charCodeAt(t)<r.charCodeAt(t)){return 1}else if(i.charCodeAt(t)>r.charCodeAt(t)){return-1}}return i.length<r.length?1:-1}}catch(n){if(DEBUG)console.log("sort error => "+n)}return 0});for(var v=0;v<h.length;v++){$("#menuforma tr").each(function(){var e=$(this);if(e.text()!=h[v])return;e.insertBefore(e.parent().find("tr:first-child"))})}if(i){$.mobile.changePage("#search",{allowSamePageTransition:true,transition:"slide",reverse:true})}else{$.mobile.changePage("#search",{allowSamePageTransition:true,transition:"slide"})}$("#menuforma").fadeIn(1e3)}
